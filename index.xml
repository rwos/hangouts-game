<?xml version="1.0" encoding="UTF-8" ?>
<Module>
    <ModulePrefs title="Shootout">
        <Require feature="rpc" />
        <Require feature="views" />
        <Require feature="locked-domain" />
    </ModulePrefs>
    <Content type="html"><![CDATA[
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <script src="//plus.google.com/hangouts/_/api/v1/hangout.js"></script>
    <script>
window.requestAnimFrame = (
    function(callback) {
      return window.requestAnimationFrame ||
          window.webkitRequestAnimationFrame ||
          window.mozRequestAnimationFrame ||
          window.oRequestAnimationFrame ||
          window.msRequestAnimationFrame ||
          function(callback) {
            window.setTimeout(callback, 1000 / 30);
          };
    })();

/*** XXX
function animate() {
  // draw
  var canvas = document.getElementById('canvas');

  render(canvas.getContext('2d'));
  // request new frame
  requestAnimFrame(function() {
    animate();
    // Send a message if you've moved.
    if (mouseDirty) {
      gapi.hangout.data.sendMessage(
          JSON.stringify([0,
                          currentColor,
                          lastTileX,
                          lastTileY]));
      mouseDirty = false;
    }
  });
}
*/


/** Get a message.
 * @param {MessageReceievedEvent} event An event.
 */
/* XXX
function onMessageReceived(event) {
  try {
    var data = JSON.parse(event.message);

    tileColor[data[2]][data[3]] = data[1];
  } catch (e) {
    console.log(e);
  }
}
*/

function init() {
  gapi.hangout.onApiReady.add(function(eventObj) {
    if (eventObj.isApiReady) {
      try {
        var canvas = gapi.hangout.layout.getVideoCanvas();
        canvas.setWidth(600);
        canvas.setPosition(0, 0);
        canvas.setVisible(true);

        /* XXX event handler here
        gapi.hangout.data.onMessageReceived.add(onMessageReceived);

        document.getElementById('canvas').onmousemove = function(e) {
          var ev = e || window.event;
          mouseMove(ev.clientX - canvas.offsetLeft,
                    ev.clientY - canvas.offsetTop);
        };
        */
        /// XXX main loop animate();

      } catch (e) {
        console.log('init:ERROR');
        console.log(e);
      }
    }
  });
}

gadgets.util.registerOnLoadHandler(init);
    </script>
    <style type="text/css">
body {
    padding: 0;
    margin: 0;
    margin-left: 600px;
    font-family: sans-serif;
    font-size: 20px;
}

#highscore {
    background: rgba(255, 255, 255, 0.5);
    table-layout: fixed;
    width: 100%;
}
#highscore .place {
    width: 2em;
}
#highscore .name {
    width: 60%;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
#highscore .points {
    text-align: right;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: 'Â«';
}

#main {
    width: 100%;
}
    </style>
  </head>
  <body>
    <table id="highscore">
      <tr>
        <td class="place">1.</td><td class="name">Someone</td><td class="points">231</td>
      </tr>
      <tr>
        <td class="place">2.</td><td class="name">Someone with a really long name</td><td class="points">231</td>
      </tr>
      <tr>
        <td class="place">3.</td><td class="name">Someone with a really long name</td><td class="points">231232132131</td>
      </tr>
    </table>
    <canvas id="main"></canvas>
  </body>
</html>
    ]]></Content>
</Module>
